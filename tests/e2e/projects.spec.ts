import { test, expect } from '@playwright/test';

test.describe('Page RÃ©alisations', () => {
  test.describe('Desktop', () => {
    test.beforeEach(async ({ page }) => {
      await page.goto('/realisations');
    });

    test('should display 5 projects', async ({ page }) => {
      const projects = page.locator('.grid a[href^="/realisations/"]');
      await expect(projects).toHaveCount(5);
    });

    test('should display project cards with required information', async ({ page }) => {
      const firstProject = page.locator('.grid a[href^="/realisations/"]').first();
      
      // VÃ©rifier l'image ou l'icÃ´ne
      await expect(firstProject.locator('img, span:has-text("ðŸ“")')).toBeVisible();
      
      // VÃ©rifier le titre
      await expect(firstProject.locator('h2')).toBeVisible();
      
      // VÃ©rifier la description
      await expect(firstProject.locator('p')).toBeVisible();
      
      // VÃ©rifier les badges technologies (au moins 1)
      const techBadges = firstProject.locator('.flex.flex-wrap.gap-2 span');
      await expect(techBadges.first()).toBeVisible();
      
      // VÃ©rifier la date (sÃ©lecteur plus spÃ©cifique)
      await expect(firstProject.locator('.flex.items-center.gap-1:has-text("ðŸ“…")')).toBeVisible();

      // VÃ©rifier le CTA
      await expect(firstProject.locator('text=Voir le projet')).toBeVisible();
    });

    test('should navigate to individual project page', async ({ page }) => {
      await page.locator('.grid a[href^="/realisations/"]').first().click();
      await expect(page).toHaveURL(/\/realisations\/[^/]+$/);
    });

    test('should display CTA to skills page', async ({ page }) => {
      // VÃ©rifier la prÃ©sence du CTA vers les compÃ©tences (plus spÃ©cifique)
      const skillsCTA = page.locator('main a[href="/competences"]:has-text("compÃ©tences")');
      await expect(skillsCTA).toBeVisible();
      await expect(skillsCTA).toContainText('compÃ©tences');
    });
  });

  test.describe('Individual Project Page', () => {
    test.beforeEach(async ({ page }) => {
      await page.goto('/realisations/projet-1');
    });

    test('should display 7 required sections', async ({ page }) => {
      // 1. PrÃ©sentation
      await expect(page.locator('h2:has-text("PrÃ©sentation")')).toBeVisible();
      
      // 2. Objectifs, contexte et enjeux
      await expect(page.locator('h2:has-text("Objectifs")')).toBeVisible();
      
      // 3. Les Ã©tapes
      await expect(page.locator('h2:has-text("Ã©tapes")')).toBeVisible();
      
      // 4. Les acteurs
      await expect(page.locator('h2:has-text("acteurs")')).toBeVisible();
      
      // 5. Les rÃ©sultats
      await expect(page.locator('h2:has-text("rÃ©sultats")')).toBeVisible();
      
      // 6. Les lendemains
      await expect(page.locator('h2:has-text("lendemains")')).toBeVisible();
      
      // 7. Mon regard critique
      await expect(page.locator('h2:has-text("regard critique")')).toBeVisible();
    });

    test('should display project metadata', async ({ page }) => {
      // VÃ©rifier la pÃ©riode
      await expect(page.locator('article .flex.items-center.gap-2:has-text("ðŸ“…")').first()).toBeVisible();
      
      // VÃ©rifier le contexte
      await expect(page.locator('header .flex.items-center.gap-2:has-text("ðŸŽ¯")')).toBeVisible();
      
      // VÃ©rifier les technologies (au moins 1)
      const techBadges = page.locator('.flex.flex-wrap.gap-2 span.bg-indigo-100');
      await expect(techBadges.first()).toBeVisible();
    });

    test('should display related skills section', async ({ page }) => {
      const relatedSkills = page.locator('section:has-text("CompÃ©tences mobilisÃ©es")');
      await expect(relatedSkills).toBeVisible();
      
      // VÃ©rifier qu'il y a au moins un lien vers les compÃ©tences
      const skillLinks = relatedSkills.locator('a[href^="/competences/"]');
      await expect(skillLinks.first()).toBeVisible();
    });

    test('should have breadcrumb navigation', async ({ page }) => {
      const breadcrumb = page.locator('article nav.mb-8');
      await expect(breadcrumb).toBeVisible();
      await expect(breadcrumb.locator('a[href="/"]')).toBeVisible();
      await expect(breadcrumb.locator('a[href="/realisations"]')).toBeVisible();
    });

    test('should have prev/next project navigation', async ({ page }) => {
      // VÃ©rifier la prÃ©sence du bouton "Tous les projets"
      await expect(page.locator('a[href="/realisations"]:has-text("Tous les projets")')).toBeVisible();
    });
  });

  test.describe('Mobile', () => {
    test.use({ viewport: { width: 375, height: 667 } });

    test('should display 5 projects on mobile', async ({ page }) => {
      await page.goto('/realisations');
      const projects = page.locator('.grid a[href^="/realisations/"]');
      await expect(projects).toHaveCount(5);
    });

    test('should display project cards in responsive layout', async ({ page }) => {
      await page.goto('/realisations');
      const firstProject = page.locator('.grid a[href^="/realisations/"]').first();
      await expect(firstProject).toBeVisible();
    });

    test('should display project details on mobile', async ({ page }) => {
      await page.goto('/realisations/projet-1');
      await expect(page.locator('h1')).toBeVisible();
      await expect(page.locator('h2:has-text("PrÃ©sentation")')).toBeVisible();
    });

    test('should have working navigation on mobile', async ({ page }) => {
      await page.goto('/realisations/projet-1');
      await expect(page.locator('a[href="/realisations"]:has-text("Tous les projets")')).toBeVisible();
    });

    test('should display breadcrumb on mobile', async ({ page }) => {
      await page.goto('/realisations/projet-1');
      const breadcrumb = page.locator('article nav.mb-8');
      await expect(breadcrumb.locator('a[href="/"]')).toBeVisible();
    });
  });
});
